# Dockerfile для сборки Linux бинарника
FROM python:3.12-slim

# Устанавливаем системные зависимости
RUN apt-get update && apt-get install -y \
    git \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Устанавливаем uv
RUN pip install uv

# Создаем рабочую директорию
WORKDIR /app

# Копируем проекты
COPY . /app/test_suite_executor/
COPY ../test_suite /app/test_suite/

# Переходим в директорию проекта
WORKDIR /app/test_suite_executor

# Устанавливаем зависимости
RUN uv sync

# Устанавливаем PyInstaller
RUN uv add pyinstaller

# Создаем бинарник
RUN uv run pyinstaller test_suite_executor.spec --clean

# Команда по умолчанию для копирования результата
CMD ["cp", "/app/test_suite_executor/dist/test-suite-executor", "/output/"]