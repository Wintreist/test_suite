# Устранение неполадок при сборке

## Частые проблемы и решения

### Windows

#### Ошибка: "uv не установлен"
**Решение:**
1. Установите uv: https://github.com/astral-sh/uv#installation
2. Перезапустите командную строку
3. Проверьте установку: `uv --version`

#### Ошибка: "Не удалось синхронизировать зависимости"
**Возможные причины:**
- Нет доступа к интернету
- Проблемы с SSH ключами для приватных репозиториев
- Неправильная конфигурация git

**Решение:**
1. Проверьте интернет соединение
2. Настройте SSH ключи для доступа к git репозиториям
3. Попробуйте запустить `uv sync --dev` вручную для диагностики

#### Ошибка при сборке PyInstaller
**Решение:**
1. Убедитесь что dev зависимости установлены: `uv sync --dev`
2. Попробуйте очистить кеш: `uv cache clean`
3. Удалите папки `build` и `dist` и попробуйте снова

#### Ошибка: "Не удалось обновить версию"
**Причина:** Проблемы с скриптом `update_version.py`

**Решение:**
1. Проверьте наличие файла `pyproject.toml` в корне проекта
2. Убедитесь что Python может импортировать модуль `tomllib`
3. Запустите скрипт вручную: `python build_scripts/update_version.py`

### Linux/macOS

#### Ошибка: "permission denied" при запуске скрипта
**Решение:**
```bash
chmod +x build_linux.sh
./build_linux.sh
```

#### Ошибка: "uv не установлен"
**Решение:**
```bash
# Установка uv на Linux/macOS
curl -LsSf https://astral.sh/uv/install.sh | sh
source ~/.bashrc
```

#### Проблемы с зависимостями на Linux
**Возможные причины:**
- Отсутствуют системные библиотеки
- Проблемы с SSL сертификатами

**Решение:**
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install build-essential libssl-dev libffi-dev

# CentOS/RHEL
sudo yum groupinstall "Development Tools"
sudo yum install openssl-devel libffi-devel
```

### Общие проблемы

#### Большой размер исполняемого файла
**Причина:** PyInstaller включает все зависимости.

**Возможные решения:**
1. Исключите ненужные модули в spec файле
2. Используйте UPX сжатие (уже включено)
3. Рассмотрите использование виртуального окружения с минимальными зависимостями

#### Медленный запуск исполняемого файла
**Причина:** PyInstaller распаковывает файлы при первом запуске.

**Решение:** Это нормальное поведение, последующие запуски будут быстрее.

#### Ошибки при работе с git репозиториями
**Решение:**
1. Убедитесь что git установлен на целевой системе
2. Настройте SSH ключи или используйте HTTPS
3. Проверьте права доступа к репозиториям

#### Ошибка: "FileNotFoundError: pyproject.toml" в исполняемом файле
**Причина:** Исполняемый файл собран со старой версией кода, которая пыталась читать pyproject.toml

**Решение:**
1. Пересоберите исполняемый файл - проблема исправлена в новой версии
2. Убедитесь что используется модуль `_version.py` вместо чтения `pyproject.toml`
3. Проверьте что скрипт `update_version.py` выполнился успешно

## Отладка

### Включение отладочного режима PyInstaller

Отредактируйте `test_suite_executor.spec`:
```python
exe = EXE(
    # ...
    debug=True,  # Изменить на True
    # ...
)
```

### Проверка зависимостей

```bash
uv run pyinstaller --collect-all test_suite_executor test_suite_executor.spec
```

### Тестирование исполняемого файла

```bash
# Windows
.\dist\test-suite-executor.exe --help

# Linux  
./dist/test-suite-executor --help
```

## Получение помощи

1. Проверьте логи сборки на наличие конкретных ошибок
2. Убедитесь что все предварительные требования выполнены
3. Попробуйте сборку в чистом окружении

Если проблема не решается, откройте issue с полным логом ошибки.